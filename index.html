<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TuneMyTrip - Buscador de Viajes</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
    body {
      font-family: 'Open Sans', Arial, sans-serif;
      margin: 20px auto;
      max-width: 600px;
      background: #f7f9fc;
      color: #222;
      line-height: 1.4;
      padding: 0 10px;
    }
    header {
      text-align: center;
      margin-bottom: 25px;
    }
    header img {
      max-width: 180px;
      height: auto;
    }
    h1 {
      text-align: center;
      color: #007bff;
      margin-bottom: 30px;
      font-weight: 700;
      font-size: 1.8rem;
      text-shadow: 0 0 4px #3399ff55;
    }
    form {
      background: white;
      padding: 25px 20px;
      border-radius: 8px;
      box-shadow: 0 6px 15px #a5c1ee44;
    }
    label {
      display: block;
      margin: 15px 0 6px 0;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    input[type="checkbox"] {
      margin-right: 8px;
      cursor: pointer;
      vertical-align: middle;
    }
    #fecha-vuelta {
      display: none;
      margin-top: 8px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 160px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    #fecha-vuelta.input-error {
      border-color: #d9534f;
      background-color: #f2dede;
    }
    #formulario-seguro {
      display: none;
      margin-top: 15px;
      padding: 12px;
      border: 1px solid #007bff;
      border-radius: 6px;
      background-color: #e7f0ff;
      max-width: 280px;
    }
    select {
      width: 100%;
      padding: 7px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    select.input-error {
      border-color: #d9534f;
      background-color: #f2dede;
    }
    .categoria {
      display: inline-block;
      padding: 10px 16px;
      margin: 7px 5px 12px 0;
      border: 2px solid #007bff;
      border-radius: 25px;
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      color: #007bff;
      transition: background-color 0.3s, color 0.3s;
      outline-offset: 3px;
    }
    .categoria.seleccionada {
      background-color: #007bff;
      color: white;
      box-shadow: 0 0 8px #3399ffaa;
    }
    .categoria:focus {
      outline: 3px solid #3399ff;
      outline-offset: 3px;
    }
    #mensajes-usuario {
      margin-bottom: 18px;
      padding: 12px 15px;
      border-radius: 6px;
      min-height: 34px;
      font-weight: 600;
      font-size: 1rem;
      display: none;
    }
    #mensajes-usuario.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    #mensajes-usuario.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    button[type="submit"] {
      margin-top: 20px;
      width: 100%;
      padding: 14px 0;
      font-size: 1.15rem;
      font-weight: 700;
      color: white;
      background-color: #007bff;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 12px #3399ffaa;
      transition: background-color 0.3s ease;
    }
    button[type="submit"]:hover,
    button[type="submit"]:focus {
      background-color: #0056b3;
      outline: none;
    }
  </style>
</head>
<body>
  <header>
    <img src="img/tunemytrip-logo.png" alt="Logo TuneMyTrip" />
  </header>

  <h1>TuneMyTrip - Buscador de Viajes</h1>

  <form id="search-form" novalidate>
    <div id="mensajes-usuario"></div>

    <label>
      <input type="checkbox" id="alojamiento" />
      ¿Necesitas alojamiento?
    </label>
    <input type="date" id="fecha-vuelta" name="fecha-vuelta" aria-label="Fecha de vuelta" />

    <label>
      <input type="checkbox" id="seguro" />
      ¿Quieres agregar seguro de viaje?
    </label>

    <div id="formulario-seguro" aria-label="Formulario de seguro de viaje">
      <label for="tipo-seguro">Tipo de seguro:</label>
      <select id="tipo-seguro" name="tipo-seguro" aria-required="true" disabled>
        <option value="">Selecciona</option>
        <option value="basico">Básico</option>
        <option value="premium">Premium</option>
      </select>
    </div>

    <label>Selecciona una categoría de viaje:</label>
    <div role="list" aria-label="Categorías de viaje" id="categorias-list">
      <div class="categoria" data-categoria="aventura" tabindex="0" role="listitem" aria-pressed="false">Aventura</div>
      <div class="categoria" data-categoria="cultural" tabindex="0" role="listitem" aria-pressed="false">Cultural</div>
      <div class="categoria" data-categoria="playa" tabindex="0" role="listitem" aria-pressed="false">Playa</div>
      <div class="categoria" data-categoria="gastronomico" tabindex="0" role="listitem" aria-pressed="false">Gastronómico</div>
    </div>

    <button type="submit">Buscar</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const alojamientoCheckbox = document.getElementById("alojamiento");
      const fechaVueltaInput = document.getElementById("fecha-vuelta");
      const seguroCheckbox = document.getElementById("seguro");
      const formularioSeguro = document.getElementById("formulario-seguro");
      const tipoSeguroSelect = document.getElementById("tipo-seguro");
      const categorias = document.querySelectorAll(".categoria");
      const mensajesContenedor = document.getElementById("mensajes-usuario");
      const form = document.getElementById("search-form");

      function mostrarMensaje(mensaje, tipo) {
        mensajesContenedor.textContent = mensaje;
        mensajesContenedor.className = tipo;
        if(mensaje) {
          mensajesContenedor.style.display = 'block';
        } else {
          mensajesContenedor.style.display = 'none';
        }
      }

      // Mostrar/ocultar fecha vuelta y limpiar errores en vivo
      alojamientoCheckbox.addEventListener("change", () => {
        fechaVueltaInput.style.display = alojamientoCheckbox.checked ? "inline-block" : "none";
        fechaVueltaInput.value = alojamientoCheckbox.checked ? fechaVueltaInput.value : "";
        fechaVueltaInput.classList.remove("input-error");
        mostrarMensaje("", "");
      });

      // Mostrar/ocultar formulario seguro y limpiar valor y errores
      seguroCheckbox.addEventListener("change", () => {
        formularioSeguro.style.display = seguroCheckbox.checked ? "block" : "none";
        tipoSeguroSelect.disabled = !seguroCheckbox.checked;
        if (!seguroCheckbox.checked) {
          tipoSeguroSelect.value = "";
          tipoSeguroSelect.classList.remove("input-error");
          mostrarMensaje("", "");
        }
      });

      // Validación en vivo fecha vuelta cuando cambia
      fechaVueltaInput.addEventListener("input", () => {
        if (alojamientoCheckbox.checked && !fechaVueltaInput.value) {
          fechaVueltaInput.classList.add("input-error");
          mostrarMensaje("Debes seleccionar una fecha de vuelta si necesitas alojamiento.", "error");
        } else {
          fechaVueltaInput.classList.remove("input-error");
          mostrarMensaje("", "");
        }
      });

      // Validación en vivo tipo seguro
      tipoSeguroSelect.addEventListener("change", () => {
        if (seguroCheckbox.checked && !tipoSeguroSelect.value) {
          tipoSeguroSelect.classList.add("input-error");
          mostrarMensaje("Debes seleccionar el tipo de seguro.", "error");
        } else {
          tipoSeguroSelect.classList.remove("input-error");
          mostrarMensaje("", "");
        }
      });

      // Manejo selección de categorías (solo una seleccionada)
      categorias.forEach((cat) => {
        cat.addEventListener("click", () => {
          categorias.forEach(c => {
            c.classList.remove("seleccionada");
            c.setAttribute("aria-pressed", "false");
          });
          cat.classList.add("seleccionada");
          cat.setAttribute("aria-pressed", "true");
          mostrarMensaje("", "");
        });
        // Permite selección con teclado tecla Enter o espacio
        cat.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            cat.click();
          }
        });
      });

      // Al enviar
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        mostrarMensaje("", ""); // Limpiar mensaje
        fechaVueltaInput.classList.remove("input-error");
        tipoSeguroSelect.classList.remove("input-error");

        // Recopilar valores
        const alojamiento = alojamientoCheckbox.checked;
        const fechaVuelta = fechaVueltaInput.value.trim();
        const seguro = seguroCheckbox.checked;
        const tipoSeguro = tipoSeguroSelect.value;
        const categoria = [...categorias].find(c => c.classList.contains("seleccionada"))?.dataset.categoria || "";

        // Validar fecha vuelta si alojamiento seleccionado
        if (alojamiento && !fechaVuelta) {
          fechaVueltaInput.classList.add("input-error");
          mostrarMensaje("Por favor, indica la fecha de vuelta porque elegiste alojamiento.", "error");
          fechaVueltaInput.focus();
          return;
        }

        // Validar al menos una categoría
        if (!categoria) {
          mostrarMensaje("Debes seleccionar una categoría de viaje.", "error");
          return;
        }

        // Validar tipo seguro si marcado
        if (seguro && !tipoSeguro) {
          tipoSeguroSelect.classList.add("input-error");
          mostrarMensaje("Selecciona un tipo de seguro o desmarca la opción de seguro.", "error");
          tipoSeguroSelect.focus();
          return;
        }

        // Mostrar mensaje de envío
        mostrarMensaje("Enviando búsqueda, por favor espera...", "success");

        // Simulación llamada a backend/API
        fetch("/api/busqueda", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ alojamiento, fechaVuelta, seguro, tipoSeguro, categoria }),
        })
          .then(response => {
            if (!response.ok)
              throw new Error("Error en la búsqueda. Intenta más tarde.");
            return response.json();
          })
          .then(data => {
            // Simulando resultados API (puede usar data real si disponible)
            const resultadosSimulados = {
              hotelResults: [
                { name: "Hotel Central", stars: 4, address: "Calle Falsa 123", price: 120 },
                { name: "Resort Playa", stars: 5, address: "Av. del Mar 45", price: 220 }
              ],
              flightResults: [
                {
                  airline: { name: "FlyNow" },
                  flight: { number: "FN123" },
                  departure: { airport: "MAD", scheduled: "2025-08-10T10:00:00Z" },
                  arrival: { airport: "BCN", scheduled: "2025-08-10T12:00:00Z" },
                  flight_status: "On Time"
                }
              ]
            };

            // Guardar resultados en localStorage para resultados.html
            localStorage.setItem('hotelResults', JSON.stringify(resultadosSimulados.hotelResults));
            localStorage.setItem('flightResults', JSON.stringify(resultadosSimulados.flightResults));

            mostrarMensaje("¡Búsqueda realizada con éxito! Redirigiendo a resultados...", "success");

            setTimeout(() => {
              window.location.href = "resultados.html";
            }, 1500);
          })
          .catch(err => {
            mostrarMensaje(err.message || "Error inesperado durante la búsqueda.", "error");
          });
      });
    });
  </script>
</body>
</html>
